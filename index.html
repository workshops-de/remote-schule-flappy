<html>

<style>
    #frame {
        width: 1000px;
        height: 600px;
        overflow: hidden;
        position: relative;
        background-image: url(assets/img/bg.png);
        background-size: cover;
    }

    #bird {
        position: absolute;
        left: 100px;
    }

    #pipe-1-top,
    #pipe-2-top,
    #pipe-3-top,
    #pipe-1-bottom,
    #pipe-2-bottom,
    #pipe-3-bottom {
        position: absolute;
    }

    #pipe-1-top,
    #pipe-2-top,
    #pipe-3-top {
        display: block;
    }

    #pipe-1-bottom,
    #pipe-2-bottom,
    #pipe-3-bottom {
        transform: scaleY(-1);
        display: block;
    }

    #score {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 40px;
      font-weight: bold;
    }

    #gameover {
      position: absolute;
      top: 50%;
      left: 50%;
      margin-left: -122px;
      margin-top: -66px;
    }
</style>

<body>
    <div id="frame">
        <img id="bird" src="assets/img/clumsy.png">
        <img id="pipe-1-top" src="assets/img/pipe.png">
        <img id="pipe-2-top" src="assets/img/pipe.png">
        <img id="pipe-3-top" src="assets/img/pipe.png">
        <img id="pipe-1-bottom" src="assets/img/pipe.png">
        <img id="pipe-2-bottom" src="assets/img/pipe.png">
        <img id="pipe-3-bottom" src="assets/img/pipe.png">
        <div id="score">0</div>
        <img id="gameover" src="assets/img/gameover.png">
    </div>
</body>

<script>

    // Globals
    var screenWidth = 1000;
    var screenHeight = 600;
    var pipeHeight = 1664;
    var pipeWidth = 148;

    // Important that script is after the body tag in our case

    var backgroundPosition = 0;
    var score = 0;
    var gameState = "GAMEOVER";

    function boxCollision(box1, box2) {
      if ( (box1.x < box2.x + box2.width) &&
           (box1.x + box1.width > box2.x) &&
           (box1.y < box2.y + box2.height) &&
           (box1.y + box1.height > box2.y)) {
        return true;
      } else {
        return false;
      }
    }

    function moveBackgroundForward() {
        backgroundPosition = backgroundPosition - 1;

        // Access elements in the html strucutre
        document.body.style.backgroundPositionX = backgroundPosition + "px";
    }

    var birdPosition = 100;
    function moveBirdUp() {
        birdPosition -= 10;
    }

    function moveBirdDown() {
        birdPosition += 10;
    }

    function handleKeyboardEvent(event) {
        /*
            LEFT:   37,
            UP:     38,
            RIGHT:  39,
            DOWN:   40
        */

        if (event.keyCode == 32) {
          if (gameState == "GAMEOVER") {
            gameState = "PLAYING";
            score = 0;
            pipes[0].left = 148*8;
            pipes[1].left = 148*8+148*3;
            pipes[2].left = 148*8+148*6;
          }
        }
        if (event.keyCode == 38) {
            moveBirdUp();
        }
        if (event.keyCode == 40) {
            moveBirdDown();
        }
    }

    window.addEventListener("keydown", handleKeyboardEvent)

    function updateBirdPosition() {
        document.getElementById("bird").style.top = birdPosition + "px";
    }


    // All about Pipes
    var pipes = [
        {
            selector: "pipe-1",
            left: 148*8,
            middle: 100,
            distance: 200,
            offset: 148*8
        },
        {
            selector: "pipe-2",
            left: 148*8+148*3,
            middle: 200,
            distance: 300,
            offset: 148*8
        },
        {
            selector: "pipe-3",
            left: 148*8+148*6,
            middle: 400,
            distance: 250,
            offset: 148*8
        }
    ]

    function updatePipe(pipe) {
      // Update positon for the pipe
      pipe.left--;

      // When we hit start of the display reset
      if (pipe.left < -148) {
          pipe.left = pipe.offset;

          // Minimum spread size to go throw at top & bottom
          pipe.middle = Math.floor(Math.random()*(screenHeight-200)+100);
          pipe.distance = Math.floor(Math.random()*200) + 100;

          score += 1;
          var scoreElement = document.getElementById("score");
          scoreElement.innerHTML = score;
      }

      // Update the element style values
      var pipeElement = document.getElementById(pipe.selector + "-top");
      pipeElement.style.left = pipe.left + "px";
      pipeElement.style.top = -pipeHeight + pipe.middle + "px";

      var pipeElement = document.getElementById(pipe.selector + "-bottom");
      pipeElement.style.left = pipe.left + "px";
      pipeElement.style.top = (pipe.middle + pipe.distance) + "px";
    }

    function collisionDetection(pipe) {
      // top pipe
      if (boxCollision({
        x: 100,
        y: birdPosition,
        width: 85,
        height: 60
      }, {
        x: pipe.left,
        y: -pipeHeight + pipe.middle,
        width: 148,
        height: pipeHeight
      })) {
        gameState = "GAMEOVER";
      }

      // bottom pipe
      if (boxCollision({
        x: 100,
        y: birdPosition,
        width: 85,
        height: 60
      }, {
        x: pipe.left,
        y: pipe.middle + pipe.distance,
        width: 148,
        height: pipeHeight
      })) {
        gameState = "GAMEOVER";
      }
    }

    function updateGame() {
      moveBackgroundForward();
      updatePipe(pipes[0]);
      updatePipe(pipes[1]);
      updatePipe(pipes[2]);

      if (gameState == "GAMEOVER") {
        var scoreElement = document.getElementById("score");
        scoreElement.style.display = "none";
        var birdElement = document.getElementById("bird");
        birdElement.style.display = "none";
        var gameoverElement = document.getElementById("gameover");
        gameoverElement.style.display = "block";
      } else {
        var scoreElement = document.getElementById("score");
        scoreElement.style.display = "block";
        var birdElement = document.getElementById("bird");
        birdElement.style.display = "block";
        var gameoverElement = document.getElementById("gameover");
        gameoverElement.style.display = "none";

        updateBirdPosition();
        collisionDetection(pipes[0]);
        collisionDetection(pipes[1]);
        collisionDetection(pipes[2]);
      }
    }

    // setInterval = execute function every x milliseconds
    setInterval(updateGame, 1);
</script>

</html>
